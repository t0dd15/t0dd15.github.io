<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retro 95 ‚Äî —ç–º—É–ª—è—Ç–æ—Ä</title>

  <!-- –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞; —Å–∏—Å—Ç–µ–º–Ω—ã–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    /* ===============================
       –¢–ï–ú–ê WIN95: —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä—ã
       =============================== */
    :root{
      --win95-bg:#008080;
      --win95-face:#C0C0C0;
      --win95-dk:#808080;
      --win95-lt:#FFFFFF;
      --win95-shadow:#404040;
      --win95-text:#000;
      --title-active:#000080;
      --title-active-2:#1084d0;
      --title-text:#fff;

      --taskbar-h: 38px;
      --font-ui: "MS Sans Serif", Tahoma, Arial, sans-serif;
      --font-pixel: "Press Start 2P", monospace;
    }

    /* ===============================
       –ë–ê–ó–ê / –°–¶–ï–ù–ê
       =============================== */
    html, body { height: 100%; }
    body{
      margin:0;
      background:
        linear-gradient(0deg, rgba(0,0,0,.25), rgba(0,0,0,.25)) 0 0/2px 2px,
        var(--win95-bg);
      image-rendering: pixelated;
      color: var(--win95-text);
      font-family: var(--font-ui);
      /* –ö—É—Ä—Å–æ—Ä Win95-–ø–æ–¥–æ–±–Ω—ã–π */
      cursor: url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="24">\
          <polygon points="0,0 0,16 4,12 7,22 10,21 7,12 12,12" fill="black"/>\
          <polygon points="1,2 1,14 4,11 7,21 9,20 6,11 11,11" fill="white"/>\
        </svg>') 1 1, default;
      overflow:hidden;
    }

    /* –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª (—Å—Ü–µ–Ω–∞ –ø–æ–¥ –æ–∫–Ω–∞–º–∏) */
    .desktop {
      position: fixed;
      inset: 0 0 var(--taskbar-h) 0;
      padding: 32px;
      outline: none;
    }

    /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—é */
    .drag-hint {
      position: absolute;
      top: 8px; left: 50%;
      transform: translateX(-50%);
      color: #fff;
      opacity: .6;
      font-size: 11px;
      font-family: var(--font-ui);
      pointer-events: none;
      user-select: none;
    }

    /* ===============================
       –ü–ê–ù–ï–õ–¨ –ó–ê–î–ê–ß
       =============================== */
    .taskbar {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: var(--taskbar-h);
      background: var(--win95-face);
      border-top: 2px solid var(--win95-shadow);
      box-shadow: inset 0 2px 0 var(--win95-lt);
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 4px 6px;
      z-index: 10_000;
    }

    /* –ö–Ω–æ–ø–∫–∞ –ü—É—Å–∫ */
    .start-btn {
      display: inline-grid;
      grid-auto-flow: column;
      align-items: center;
      gap: 6px;
      height: calc(var(--taskbar-h) - 10px);
      padding: 0 10px;
      background: var(--win95-face);
      border: 1px solid var(--win95-shadow);
      box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      cursor: pointer;
      user-select: none;
      font-weight: 700;
    }
    .start-btn:active{
      box-shadow: inset 1px 1px 0 var(--win95-dk), inset -1px -1px 0 var(--win95-lt);
      transform: translateY(1px);
    }

    /* –ü—Ä–æ—Å—Ç–æ–µ –º–µ–Ω—é –ü—É—Å–∫ */
    .start-menu {
      position: fixed;
      left: 6px;
      bottom: var(--taskbar-h);
      width: 220px;
      background: var(--win95-face);
      border: 2px solid var(--win95-shadow);
      box-shadow: 4px 4px 0 rgba(0,0,0,.25), inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      display: none;
    }
    .start-menu.open { display: block; }
    .menu-item {
      padding: 8px 10px;
      border-bottom: 1px solid #aaa;
      cursor: default;
    }
    .menu-item:last-child{ border-bottom: 0; }
    .menu-item:hover { background: #000080; color: #fff; }

    /* –í–∫–ª–∞–¥–∫–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–Ω–æ–ø–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏ –∑–∞–¥–∞—á) */
    .task-buttons {
      display: flex;
      gap: 6px;
      align-items: center;
      overflow-x: auto;
      scrollbar-width: thin;
    }
    .task-tab {
      min-width: 140px;
      padding: 0 10px;
      height: calc(var(--taskbar-h) - 10px);
      display: grid; align-items: center;
      background: var(--win95-face);
      border: 1px solid var(--win95-shadow);
      box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      cursor: pointer;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .task-tab.active {
      /* –ù–∞–∂–∞—Ç–∞—è/–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ */
      box-shadow: inset 1px 1px 0 var(--win95-dk), inset -1px -1px 0 var(--win95-lt);
    }

    /* –ß–∞—Å—ã */
    .clock {
      min-width: 80px;
      text-align: center;
      padding: 0 8px;
      height: calc(var(--taskbar-h) - 10px);
      display: grid; align-items: center;
      background: var(--win95-face);
      border: 1px solid var(--win95-shadow);
      box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      font-variant-numeric: tabular-nums;
    }

    /* ===============================
       –û–ö–ù–ê (–æ—à–∏–±–∫–∏/–¥–∏–∞–ª–æ–≥–∏)
       =============================== */
    .win {
      position: absolute;
      width: min(520px, 95vw);
      background: var(--win95-face);
      border: 2px solid var(--win95-shadow);
      box-shadow: 2px 2px 0 var(--win95-dk),
                  -1px -1px 0 var(--win95-lt),
                  8px 8px 0 rgba(0,0,0,.25);
      user-select: none;
    }
    .win.hidden { display: none; }

    .win__titlebar{
      height: 26px;
      display: flex; align-items: center; gap: 8px;
      background: linear-gradient(90deg, var(--title-active) 0%, var(--title-active-2) 100%);
      color: var(--title-text); padding: 0 6px;
      font-weight: 700; font-size: 13px;
      -webkit-font-smoothing: none;
      cursor: move;
    }
    .win__title { pointer-events: none; }
    .win__buttons{ margin-left: auto; display: flex; gap: 6px; }
    .tb-btn{
      width:18px; height:18px; background:var(--win95-face);
      box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      border:1px solid var(--win95-shadow); display:grid; place-items:center; cursor:pointer;
    }
    .tb-btn:active{
      box-shadow: inset 1px 1px 0 var(--win95-dk), inset -1px -1px 0 var(--win95-lt);
    }

    .win__body{ display:flex; gap:12px; padding:16px 14px 12px; align-items:flex-start }
    .icon{
      width:36px; height:36px; flex:0 0 36px; margin-top:2px;
      background:
        radial-gradient(circle at 30% 30%, #ff0000 0 35%, #a00000 36% 70%, transparent 0) no-repeat,
        radial-gradient(circle at 64% 64%, #ff8080 0 20%, transparent 21%) no-repeat;
      border:1px solid #700; box-shadow: inset 1px 1px 0 #fcc;
    }
    .msg{ font-size:14px; line-height:1.3; }
    .hr{ height:2px; background:var(--win95-face); box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt); margin:8px 0 10px; }

    .btn95{
      padding:6px 18px; font-size:13px; background:var(--win95-face);
      border:1px solid var(--win95-shadow);
      box-shadow: inset -1px -1px 0 var(--win95-dk), inset 1px 1px 0 var(--win95-lt);
      cursor:pointer; min-width:110px;
    }
    .btn95:active{
      box-shadow: inset 1px 1px 0 var(--win95-dk), inset -1px -1px 0 var(--win95-lt);
      padding-top:7px; padding-left:19px; padding-bottom:5px; padding-right:17px;
    }
    .win__actions{ display:flex; gap:10px; justify-content:flex-end; padding:0 14px 14px }

    /* –í–∞—Ä–∏–∞—Ü–∏–∏ –∏–∫–æ–Ω–æ–∫ (–ø–æ —Ü–≤–µ—Ç–∞–º) */
    .icon--gold{
      background:
       radial-gradient(circle at 30% 30%, #ffbf00 0 35%, #a07a00 36% 70%, transparent 0) no-repeat,
       radial-gradient(circle at 64% 64%, #ffe680 0 20%, transparent 21%) no-repeat;
      border-color:#765400;
    }
    .icon--green{
      background:
       radial-gradient(circle at 30% 30%, #00cc66 0 35%, #008844 36% 70%, transparent 0) no-repeat,
       radial-gradient(circle at 64% 64%, #88ffcc 0 20%, transparent 21%) no-repeat;
      border-color:#0a6a3f;
    }

    /* –§–æ–∫—É—Å –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
    .focus-ring:focus-visible { outline: 2px dashed #000; outline-offset: 2px; }
  </style>
</head>
<body>
  <!-- –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª -->
  <div class="desktop" tabindex="-1" aria-label="–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª">
    <div class="drag-hint">–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π –æ–∫–Ω–∞ –∑–∞ —Å–∏–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫</div>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á -->
  <div class="taskbar" role="toolbar" aria-label="–ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á">
    <button class="start-btn focus-ring" id="startBtn" aria-haspopup="true" aria-expanded="false">ü™ü –ü—É—Å–∫</button>
    <div class="task-buttons" id="taskButtons" aria-label="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"></div>
    <div class="clock" id="clock" aria-label="–ß–∞—Å—ã">--:--</div>
  </div>

  <!-- –ú–µ–Ω—é –ü—É—Å–∫ -->
  <div class="start-menu" id="startMenu" role="menu">
    <div class="menu-item" role="menuitem">–û –ø—Ä–æ–≥—Ä–∞–º–º–µ‚Ä¶ (—à—É—Ç–ª–∏–≤–æ)</div>
    <div class="menu-item" role="menuitem">–í—ã–∫–ª—é—á–∏—Ç—å‚Ä¶ (–µ—â—ë —à—É—Ç–ª–∏–≤–µ–µ)</div>
  </div>

  <script>
  // ===============================
  //  –≠–ú–£–õ–Ø–¢–û–† WIN95 ‚Äî –õ–û–ì–ò–ö–ê
  // ===============================
  (function(){
    /** –û–ø–∏—Å–∞–Ω–∏–µ ¬´–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π¬ª, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –¥–∏–∞–ª–æ–≥–∏-–æ—à–∏–±–∫–∏ */
    const APPS = [
      {
        id: 'gradients',
        tabLabel: '–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã',
        windowIcon: 'red',
        title: '–û—à–∏–±–∫–∞',
        heading: '–°–æ–∑–¥–∞–Ω–∏–µ Minecraft-–≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤',
        text: '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –∑–∞–≥–∞–¥–æ—á–Ω–∞—è —É–¥–∞—á–∞: –Ω–∞–π–¥–µ–Ω –ª—É—á—à–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä RGB-–Ω–∏–∫–∞!',
        link: '/gradients/'
      },
      {
        id: 'links',
        tabLabel: '–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏',
        windowIcon: 'gold',
        title: '–û—à–∏–±–∫–∞',
        heading: '–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
        text: '–°–±–æ—Ä–Ω–∏–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞. –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–µ–º.',
        link: '/links.html'
      },
      {
        id: 'about',
        tabLabel: '–û–±–æ –º–Ω–µ',
        windowIcon: 'green',
        title: '–û—à–∏–±–∫–∞',
        heading: '–û–±–æ –º–Ω–µ',
        text: '–ö–æ—Ä–æ—Ç–∫–æ –æ —Ç–æ–º, –∫—Ç–æ —è, —á–µ–º –∑–∞–Ω–∏–º–∞—é—Å—å –∏ –∫–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è.',
        link: '/about.html'
      }
    ];

    // –£–∑–ª—ã DOM
    const desktop     = document.querySelector('.desktop');
    const taskButtons = document.getElementById('taskButtons');
    const clockEl     = document.getElementById('clock');
    const startBtn    = document.getElementById('startBtn');
    const startMenu   = document.getElementById('startMenu');

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∫–æ–Ω –∏ Z-–∏–Ω–¥–µ–∫—Å
    let zCounter = 100;
    /** Map: id -> { winEl, tabEl, minimized } */
    const state = new Map();

    // -------------------------------
    //   –ó –í –£ –ö  (Windows-–ø–æ–¥–æ–±–Ω—ã–π)
    // -------------------------------
    function playDing(){
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'triangle';
      // –∫–æ—Ä–æ—Ç–∫–∏–π "–¥–∏–Ω—å": 880 –ì—Ü -> 660 –ì—Ü
      osc.frequency.setValueAtTime(880, ctx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(660, ctx.currentTime + 0.12);
      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.25);
      osc.connect(gain).connect(ctx.destination);
      osc.start(); osc.stop(ctx.currentTime + 0.26);
    }

    // -------------------------------
    //   –ß –ê –° –´
    // -------------------------------
    function updateClock(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      clockEl.textContent = `${hh}:${mm}`;
      // –ø–æ–¥—Å–∫–∞–∑–∫–∞ —Å –¥–∞—Ç–æ–π
      clockEl.title = d.toLocaleDateString();
    }
    updateClock();
    setInterval(updateClock, 1000 * 20); // —Ä–∞–∑ –≤ 20 —Å–µ–∫ (—Ö–≤–∞—Ç–∞–µ—Ç)

    // -------------------------------
    //   –ü –£ –° –ö  (–ø—Ä–æ—Å—Ç–æ–µ –º–µ–Ω—é)
    // -------------------------------
    function toggleStartMenu(force){
      const open = force ?? !startMenu.classList.contains('open');
      startMenu.classList.toggle('open', open);
      startBtn.setAttribute('aria-expanded', String(open));
    }
    startBtn.addEventListener('click', ()=>toggleStartMenu());
    document.addEventListener('click', (e)=>{
      if (!startMenu.contains(e.target) && e.target !== startBtn) {
        toggleStartMenu(false);
      }
    });

    // -------------------------------
    //   –ü–ê–ù–ï–õ–¨ –ó–ê–î–ê–ß ‚Äî –≤–∫–ª–∞–¥–∫–∏
    // -------------------------------
    function createTaskTab(app){
      const btn = document.createElement('button');
      btn.className = 'task-tab focus-ring';
      btn.type = 'button';
      btn.textContent = app.tabLabel;
      btn.setAttribute('data-app', app.id);
      btn.addEventListener('click', ()=> toggleAppWindow(app.id));
      taskButtons.appendChild(btn);
      return btn;
    }

    // -------------------------------
    //   –û–ö–ù–û: —Å–æ–∑–¥–∞–Ω–∏–µ + –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    // -------------------------------
    function createWindow(app){
      const win = document.createElement('div');
      win.className = 'win';
      win.setAttribute('role','dialog');
      win.setAttribute('aria-modal','false');
      win.style.zIndex = String(++zCounter);

      // –ò–∫–æ–Ω–∫–∞-—Ü–≤–µ—Ç
      const iconClass = app.windowIcon === 'gold' ? 'icon--gold'
                        : app.windowIcon === 'green' ? 'icon--green' : '';

      win.innerHTML = `
        <div class="win__titlebar">
          <div class="win__title">${app.title}</div>
          <div class="win__buttons">
            <div class="tb-btn" data-cmd="min" title="–°–≤–µ—Ä–Ω—É—Ç—å">‚Äì</div>
            <div class="tb-btn" data-cmd="max" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å">‚ñ°</div>
            <div class="tb-btn" data-cmd="close" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</div>
          </div>
        </div>
        <div class="win__body">
          <div class="icon ${iconClass}" aria-hidden="true"></div>
          <div class="msg">
            <b>${app.heading}</b><br>
            ${app.text}
            <div class="hr"></div>
            <div class="small">–ù–∞–∂–º–∏ <i>OK</i>, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.</div>
          </div>
        </div>
        <div class="win__actions">
          <button class="btn95 focus-ring" data-action="ok">OK</button>
          <button class="btn95 focus-ring" data-action="cancel">–û—Ç–º–µ–Ω–∞</button>
        </div>
      `;

      desktop.appendChild(win);
      centerWindow(win);
      initWindowDrag(win);
      initWindowButtons(win, app);
      // –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ —Å–∏–Ω–µ–π –ø–∞–Ω–µ–ª–∏ ‚Äî —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç/–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç
      win.querySelector('.win__titlebar').addEventListener('dblclick', ()=>{
        toggleMaximized(win);
      });

      // —Ñ–æ–∫—É—Å –ø–æ –∫–ª–∏–∫—É ‚Äî –Ω–∞–≤–µ—Ä—Ö
      win.addEventListener('mousedown', ()=>{
        win.style.zIndex = String(++zCounter);
      });

      return win;
    }

    // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏
    function centerWindow(win){
      const rect = desktop.getBoundingClientRect();
      const ww = win.offsetWidth;
      const wh = win.offsetHeight;
      const left = Math.max(6, rect.left + (rect.width - ww)/2);
      const top  = Math.max(6, rect.top  + (rect.height - wh)/2 - 40);
      win.style.left = left + 'px';
      win.style.top  = top + 'px';
    }

    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ –∑–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–≥—Ä–∞–Ω–∏—Ü—ã ‚Äî —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å)
    function initWindowDrag(win){
      const bar = win.querySelector('.win__titlebar');
      let sx=0, sy=0, ox=0, oy=0, dragging=false, maximized=false;

      function start(e){
        // –µ—Å–ª–∏ –æ–∫–Ω–æ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ ‚Äî —Å–Ω–∞—á–∞–ª–∞ ¬´–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å¬ª
        if (win.dataset.maximized === '1') toggleMaximized(win);
        dragging = true;
        const p = ('touches' in e)? e.touches[0] : e;
        sx = p.clientX; sy = p.clientY;
        const r = win.getBoundingClientRect();
        ox = r.left; oy = r.top;
        e.preventDefault();
      }
      function move(e){
        if(!dragging) return;
        const p = ('touches' in e)? e.touches[0] : e;
        const nx = ox + (p.clientX - sx);
        const ny = oy + (p.clientY - sy);
        const area = desktop.getBoundingClientRect();
        const maxX = area.right - win.offsetWidth;
        const maxY = area.bottom - win.offsetHeight;
        win.style.left = Math.max(area.left, Math.min(nx, maxX)) + 'px';
        win.style.top  = Math.max(area.top,  Math.min(ny, maxY)) + 'px';
      }
      function end(){ dragging=false; }

      bar.addEventListener('mousedown', start);
      window.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);

      bar.addEventListener('touchstart', start, {passive:false});
      window.addEventListener('touchmove', move, {passive:false});
      window.addEventListener('touchend', end);
    }

    // –ö–Ω–æ–ø–∫–∏ –æ–∫–Ω–∞: —Å–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/–∑–∞–∫—Ä—ã—Ç—å, –û–ö/–û—Ç–º–µ–Ω–∞
    function initWindowButtons(win, app){
      const tab = state.get(app.id)?.tabEl;

      win.querySelectorAll('.tb-btn').forEach(btn=>{
        const cmd = btn.getAttribute('data-cmd');
        if (cmd === 'min'){
          btn.addEventListener('click', ()=> minimizeWindow(app.id));
        } else if (cmd === 'max'){
          btn.addEventListener('click', ()=> toggleMaximized(win));
        } else if (cmd === 'close'){
          btn.addEventListener('click', ()=> closeWindow(app.id));
        }
      });

      win.querySelector('[data-action="ok"]').addEventListener('click', ()=>{
        window.location.assign(app.link);
      });
      win.querySelector('[data-action="cancel"]').addEventListener('click', ()=>{
        // –ª—ë–≥–∫–æ–µ ¬´—Å–º—è—Ç–∏–µ¬ª, –∑–∞—Ç–µ–º —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
        win.style.transform = 'scale(0.98)';
        setTimeout(()=>{
          win.style.transform = 'none';
          minimizeWindow(app.id);
        }, 120);
      });

      // –û—Ç—Ä–∞–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫–µ
      if (tab){
        tab.classList.add('active');
        tab.setAttribute('aria-pressed','true');
      }
    }

    function toggleMaximized(win){
      const area = desktop.getBoundingClientRect();
      const isMax = win.dataset.maximized === '1';
      if (!isMax){
        // –∑–∞–ø–æ–º–Ω–∏–º –ø–æ–∑–∏—Ü–∏—é/—Ä–∞–∑–º–µ—Ä
        win.dataset.prevLeft = win.style.left;
        win.dataset.prevTop  = win.style.top;
        win.dataset.prevW    = win.style.width;
        win.dataset.prevH    = win.style.height;
        win.style.left = area.left + 'px';
        win.style.top  = area.top + 'px';
        win.style.width = area.width + 'px';
        win.style.height = area.height + 'px';
        win.dataset.maximized = '1';
      } else {
        win.style.left = win.dataset.prevLeft || win.style.left;
        win.style.top  = win.dataset.prevTop  || win.style.top;
        win.style.width = win.dataset.prevW || '';
        win.style.height= win.dataset.prevH || '';
        win.dataset.maximized = '0';
      }
    }

    // -------------------------------
    //   –û–¢–ö–†–´–¢–ò–ï/–°–í–û–†–ê–ß–ò–í–ê–ù–ò–ï/–ó–ê–ö–†–´–¢–ò–ï
    // -------------------------------
    function openWindow(appId){
      const app = APPS.find(a=>a.id===appId);
      if (!app) return;

      let rec = state.get(appId);
      if (!rec){
        const tabEl = document.querySelector(`.task-tab[data-app="${appId}"]`) || createTaskTab(app);
        const winEl = createWindow(app);
        rec = { winEl, tabEl, minimized: false };
        state.set(appId, rec);
      } else if (rec.minimized){
        // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
        rec.winEl.classList.remove('hidden');
        rec.minimized = false;
        rec.tabEl.classList.add('active');
      }

      rec.winEl.style.zIndex = String(++zCounter);
      playDing();
      return rec.winEl;
    }

    function minimizeWindow(appId){
      const rec = state.get(appId);
      if (!rec) return;
      rec.winEl.classList.add('hidden');
      rec.minimized = true;
      rec.tabEl.classList.remove('active');
      rec.tabEl.setAttribute('aria-pressed','false');
    }

    function closeWindow(appId){
      const rec = state.get(appId);
      if (!rec) return;
      rec.winEl.remove();
      rec.tabEl.classList.remove('active');
      rec.tabEl.setAttribute('aria-pressed','false');
      state.delete(appId);
    }

    function toggleAppWindow(appId){
      const rec = state.get(appId);
      if (!rec || rec.minimized){
        openWindow(appId);
      } else {
        // –µ—Å–ª–∏ –æ–∫–Ω–æ –≤–∏–¥–Ω–æ ‚Äî —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
        minimizeWindow(appId);
      }
    }

    // -------------------------------
    //   –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // -------------------------------
    // –°–æ–∑–¥–∞—ë–º –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ø–æ –¢–ó: –æ–∫–Ω–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ –∫–ª–∏–∫—É –Ω–∞ –≤–∫–ª–∞–¥–∫—É)
    APPS.forEach(app => {
      createTaskTab(app);
    });

    // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞: Esc ‚Äî –∑–∞–∫—Ä—ã—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –≤–µ—Ä—Ö–Ω–µ–µ –æ–∫–Ω–æ
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape'){
        // –Ω–∞–π–¥—ë–º –≤–µ—Ä—Ö–Ω–µ–µ –æ–∫–Ω–æ
        let topId = null, topZ = -1;
        state.forEach((rec, id)=>{
          if (!rec.minimized){
            const z = parseInt(rec.winEl.style.zIndex || '0', 10);
            if (z > topZ){ topZ = z; topId = id; }
          }
        });
        if (topId) closeWindow(topId);
      }
    });

    // –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ–∫–Ω–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –æ–±–ª–∞—Å—Ç–∏
    window.addEventListener('resize', ()=>{
      state.forEach(rec=>{
        const area = desktop.getBoundingClientRect();
        const r = rec.winEl.getBoundingClientRect();
        // –µ—Å–ª–∏ –æ–∫–Ω–æ –≤—ã–ª–µ–∑–ª–æ ‚Äî –≤–µ—Ä–Ω—ë–º –≤ –æ–±–ª–∞—Å—Ç—å
        const left = Math.min(Math.max(r.left, area.left), area.right - rec.winEl.offsetWidth);
        const top  = Math.min(Math.max(r.top,  area.top),  area.bottom - rec.winEl.offsetHeight);
        rec.winEl.style.left = left + 'px';
        rec.winEl.style.top  = top + 'px';
      });
    });
  })();
  </script>
</body>
</html>
