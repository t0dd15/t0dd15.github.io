<!doctype html> 
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>:—Ä</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0c0f1e; --panel:#121636; --muted:#9aa3d5; --text:#eaf0ff;
    --accent:#78a6ff; --line:rgba(255,255,255,.1);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:
      radial-gradient(1200px 600px at 10% 10%, #1a2050 0%, transparent 60%) no-repeat,
      radial-gradient(1000px 500px at 90% 20%, #22285f 0%, transparent 60%) no-repeat,
      var(--bg);
    color:var(--text);
    font-family:'Press Start 2P', monospace;
  }
  .wrap{max-width:1200px; margin:0 auto; padding:18px}
  h1{font-size:18px; margin:0 0 14px}
  .grid{display:grid; grid-template-columns: 330px 1fr 380px; gap:14px}
  @media (max-width:1100px){ .grid{grid-template-columns:1fr} }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid var(--line); border-radius:14px; padding:14px; backdrop-filter: blur(6px);
  }
  .sectionTitle{font-size:12px; color:var(--muted); margin:0 0 10px}
  label{font-size:11px; color:var(--muted); display:block; margin:6px 0 6px}
  input[type="text"], input[type="number"], select, textarea{
    width:100%; background:#0f1330; border:1px solid var(--line); color:var(--text);
    border-radius:10px; padding:10px 12px; font-family:inherit; font-size:12px; outline:none;
  }
  input[type="color"]{appearance:none; width:100%; height:40px; border-radius:10px; border:1px solid var(--line); background:#0f1330}
  .row{display:flex; gap:10px; align-items:center}
  .row>*{flex:1}
  .btn{background:#10163a; border:1px solid var(--line); color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .chips{display:flex; flex-wrap:wrap; gap:8px}
  .chip{padding:8px 10px; border:1px solid var(--line); border-radius:8px; cursor:pointer; background:#0f1330; font-size:11px}
  .chip.active{outline:2px solid var(--accent)}
  .preview{
    min-height:220px; display:flex; align-items:center; justify-content:center; border-radius:12px; background:#151a40; position:relative; overflow:auto;
  }
  .nick{font-weight:700; font-size:48px; white-space:pre-wrap; text-align:center}
  .options{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .colors{display:grid; gap:10px}
  .colorRow{display:grid; grid-template-columns:1fr 110px auto; gap:8px; align-items:center}
  .link{color:var(--accent); text-decoration:none}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px}
  .tabs{display:flex; gap:8px; margin-bottom:10px}
  .tab{padding:8px 10px; border:1px solid var(--line); background:#0f1330; border-radius:8px; cursor:pointer; font-size:11px}
  .tab.active{outline:2px solid var(--accent)}
  .out{min-height:110px; background:#0f1330; border:1px dashed var(--line); border-radius:10px; padding:10px; word-break:break-all}
  .hr{height:1px; background:var(--line); margin:10px 0}
  small{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>—è –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–∫—Ä–∞–ª —ç—Ç–æ—Ç —Å–∞–π—Ç —É Birdflop, –∏ –º–Ω–µ –ø–æ—á—Ç–∏ –Ω–µ —Å—Ç—ã–¥–Ω–æ, —è –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–µ–ª —á—Ç–æ —Ç–æ —Å–≤–æ–µ</h1>
  <div class="grid">
    <!-- LEFT: controls -->
    <section class="card">
      <p class="sectionTitle">–í–≤–æ–¥</p>
      <label>–¢–µ–∫—Å—Ç</label>
      <textarea id="text" rows="3" placeholder="Type here to generate a gradient!">t0dd15</textarea>

      <div class="hr"></div>
      <p class="sectionTitle">–¶–≤–µ—Ç–∞</p>
      <div id="colors" class="colors"></div>
      <div class="chips" style="margin-top:6px">
        <button id="addColor" class="chip">+ —Å—Ç–æ–ø</button>
        <button id="removeColor" class="chip">‚Äì —Å—Ç–æ–ø</button>
        <button id="reverseColors" class="chip">‚Üî —Ä–µ–≤–µ—Ä—Å</button>
        <button id="presetsBtn" class="chip">üé® –ø—Ä–µ—Å–µ—Ç—ã</button>
      </div>

      <div class="hr"></div>
      <p class="sectionTitle">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</p>
      <div class="options">
        <div>
          <label>–†–µ–∂–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</label>
          <select id="mode">
            <option value="even" selected>–í—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ (disperse)</option>
            <option value="map">–ü–æ ¬´–∫–∞—Ä—Ç–µ¬ª (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–∏–º–≤–æ–ª–æ–≤)</option>
          </select>
        </div>
        <div>
          <label>–°–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Ü–≤–µ—Ç (–¥–ª—è —Ä–µ–∂–∏–º–∞ ¬´–∫–∞—Ä—Ç–∞¬ª)</label>
          <input id="charsPerColor" type="number" min="1" value="2">
        </div>
        <div>
          <label>–ü—Ä–∏–≤–æ–¥–∏—Ç—å HEX –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É</label>
          <select id="lower">
            <option value="no" selected>–ù–µ—Ç</option>
            <option value="yes">–î–∞</option>
          </select>
        </div>
        <div>
          <label>–û–±—Ä–µ–∑–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –∏–∑ —Ä–∞—Å–∫—Ä–∞—Å–∫–∏</label>
          <select id="trim">
            <option value="yes" selected>–î–∞</option>
            <option value="no">–ù–µ—Ç</option>
          </select>
        </div>
        <div>
          <label>–¢–µ–Ω—å —Ç–µ–∫—Å—Ç–∞ (JSON –ø—Ä–µ–≤—å—é)</label>
          <select id="shadow">
            <option value="no" selected>–ù–µ—Ç</option>
            <option value="yes">–î–∞</option>
          </select>
        </div>
        <div>
          <label>–†–∞–∑–º–µ—Ä –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (px)</label>
          <input id="size" type="number" min="16" max="160" value="72">
        </div>
      </div>

      <div class="hr"></div>
      <p class="sectionTitle">–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
      <div class="chips">
        <label class="chip"><input type="checkbox" id="bold"> &l Bold</label>
        <label class="chip"><input type="checkbox" id="italic"> &o Italic</label>
        <label class="chip"><input type="checkbox" id="under"> &n Underline</label>
        <label class="chip"><input type="checkbox" id="strike"> &m Strike</label>
        <label class="chip"><input type="checkbox" id="obf"> &k Obf</label>
      </div>

      <div class="hr"></div>
      <p class="sectionTitle">–ü—Ä–µ-/–°—É—Ñ—Ñ–∏–∫—Å</p>
      <div class="row">
        <div>
          <label>–ü—Ä–µ—Ñ–∏–∫—Å</label>
          <input id="prefix" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, [&aVIP] ">
        </div>
        <div>
          <label>–°—É—Ñ—Ñ–∏–∫—Å</label>
          <input id="suffix" type="text" placeholder=" –Ω–∞–ø—Ä–∏–º–µ—Ä, &7#1">
        </div>
      </div>

      <div class="hr"></div>
      <p class="sectionTitle">–ü—Ä–µ—Å–µ—Ç—ã</p>
      <div class="row">
        <button id="savePreset" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="loadPreset" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <button id="copyUrl" class="btn">–°—Å—ã–ª–∫–∞</button>
      </div>
      <small>–ü—Ä–µ—Å–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage; ¬´–°—Å—ã–ª–∫–∞¬ª –∫–æ–¥–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ URL.</small>
    </section>

    <!-- MIDDLE: preview -->
    <section class="card">
      <p class="sectionTitle">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
      <div class="preview">
        <div id="preview" class="nick">Birdflop</div>
      </div>
      <small>–ì—Ä–∞–¥–∏–µ–Ω—Ç —Å–ª–µ–≤–∞ ‚Üí –Ω–∞–ø—Ä–∞–≤–æ. –®—Ä–∏—Ñ—Ç ‚Äî –ø–∏–∫—Å–µ–ª—å–Ω—ã–π Minecraft-—Å—Ç–∞–π–ª.</small>
    </section>

    <!-- RIGHT: outputs -->
    <section class="card">
      <p class="sectionTitle">–í—ã–≤–æ–¥</p>
      <div class="tabs">
        <button class="tab active" data-tab="mini">MiniMessage</button>
        <button class="tab" data-tab="json">JSON</button>
        <button class="tab" data-tab="sec">¬ßx</button>
        <button class="tab" data-tab="amp">&x</button>
        <button class="tab" data-tab="sharp"><#rrggbb></button>
        <button class="tab" data-tab="custom">Custom</button>
      </div>
      <div id="out" class="out mono"></div>
      <div class="row" style="margin-top:10px">
        <button id="copy" class="btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="decode" class="btn">Decode (—ç–∫—Å–ø.)</button>
      </div>

      <div class="hr"></div>
      <p class="sectionTitle">Custom-—à–∞–±–ª–æ–Ω</p>
      <textarea id="customTpl" rows="4" class="mono" placeholder='{"color":"[COLOR=#$1$2$3$4$5$6]$c[/COLOR]","bold":"[B]$t[/B]"}'></textarea>
      <small>–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: <code>$t</code> ‚Äî —Ç–µ–∫—Å—Ç; <code>$c</code> ‚Äî —Å–∏–º–≤–æ–ª; <code>$1..$6</code> ‚Äî HEX –ø–æ —Ü–∏—Ñ—Ä–∞–º. –î–ª—è ¬ß –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>"char":"¬ß"</code>.</small>
    </section>
  </div>
</div>

<script>
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));

/* ====== state ====== */
const state = {
  colors: ['#54DAF4','#54C8EB','#54B7E2','#54A5D9'],
  mode: 'even', // 'even' | 'map'
  charsPerColor: 2,
  lower:false, trim:true, shadow:false,
  size:72, fmt:'mini',
  flags:{bold:false, italic:false, under:false, strike:false, obf:false},
  prefix:'', suffix:'',
  text:'Birdflop',
  customTpl:''
};

/* ====== UI build: colors ====== */
const colorsEl = $('#colors');
function rebuildColors(){
  colorsEl.innerHTML='';
  state.colors.forEach((hex,i)=>{
    const row = document.createElement('div');
    row.className='colorRow';
    row.innerHTML = `
      <input type="color" value="${hex}">
      <input type="text" value="${hex}" class="mono" />
      <button class="btn" data-del="${i}">‚úï</button>
    `;
    const [pc,pt,btn] = row.children;
    pc.addEventListener('input', e=>{ state.colors[i]=e.target.value; pt.value=e.target.value; update(); });
    pt.addEventListener('input', e=>{
      const v=e.target.value; if(/^#?[0-9a-fA-F]{0,6}$/.test(v.replace('#',''))){ state.colors[i] = v.startsWith('#')?v:('#'+v); pc.value=state.colors[i]; update(); }
    });
    btn.addEventListener('click', ()=>{ if(state.colors.length>2){ state.colors.splice(i,1); rebuildColors(); update(); } });
    colorsEl.appendChild(row);
  });
}
$('#addColor').onclick=()=>{ state.colors.push('#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0')); rebuildColors(); update(); };
$('#removeColor').onclick=()=>{ if(state.colors.length>2){ state.colors.pop(); rebuildColors(); update(); } };
$('#reverseColors').onclick=()=>{ state.colors.reverse(); rebuildColors(); update(); };
$('#presetsBtn').onclick=()=>{
  // –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–µ—Å–µ—Ç—ã
  const presets = {
    Sunset:['#ff7e5f','#feb47b','#ffd56b'],
    Ocean:['#00c6ff','#0072ff'],
    Ender:['#3a1c71','#d76d77','#ffaf7b'],
    LimeCandy:['#A8FF78','#78FFD6'],
    RGB:['#FF0000','#00FF00','#0000FF']
  };
  const keys=Object.keys(presets);
  const pick = prompt('–í—ã–±–µ—Ä–∏ –ø—Ä–µ—Å–µ—Ç:\n'+keys.join(', '));
  if(!pick || !presets[pick]) return;
  state.colors=[...presets[pick]]; rebuildColors(); update();
};

/* ====== inputs ====== */
$('#text').oninput=e=>{ state.text=e.target.value; update(); };
$('#mode').onchange=e=>{ state.mode=e.target.value; update(); };
$('#charsPerColor').oninput=e=>{ state.charsPerColor=Math.max(1,parseInt(e.target.value||'1')); update(); };
$('#lower').onchange=e=>{ state.lower=e.target.value==='yes'; update(); };
$('#trim').onchange=e=>{ state.trim=e.target.value==='yes'; update(); };
$('#shadow').onchange=e=>{ state.shadow=e.target.value==='yes'; update(); };
$('#size').oninput=e=>{ state.size=Math.max(16,Math.min(160,parseInt(e.target.value||'72'))); update(); };
$('#bold').onchange=e=>{ state.flags.bold=e.target.checked; update(); };
$('#italic').onchange=e=>{ state.flags.italic=e.target.checked; update(); };
$('#under').onchange=e=>{ state.flags.under=e.target.checked; update(); };
$('#strike').onchange=e=>{ state.flags.strike=e.target.checked; update(); };
$('#obf').onchange=e=>{ state.flags.obf=e.target.checked; update(); };
$('#prefix').oninput=e=>{ state.prefix=e.target.value; update(); };
$('#suffix').oninput=e=>{ state.suffix=e.target.value; update(); };

$$('.tab').forEach(btn=>btn.onclick=()=>{
  $$('.tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  state.fmt = btn.dataset.tab;
  update();
});
$('#customTpl').oninput=e=>{ state.customTpl=e.target.value; update(); };

/* ====== utils ====== */
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const hexToRgb=h=>({r:parseInt(h.slice(1,3),16), g:parseInt(h.slice(3,5),16), b:parseInt(h.slice(5,7),16)});
const rgbToHex=({r,g,b})=>'#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('').toUpperCase();
const lerp=(a,b,t)=>a+(b-a)*t;
const lerpRgb=(A,B,t)=>({r:Math.round(lerp(A.r,B.r,t)),g:Math.round(lerp(A.g,B.g,t)),b:Math.round(lerp(A.b,B.b,t))});
const splitChars=str=>Array.from(str);

/* piecewise gradient t in [0..1] across N stops */
function gradientAt(t, stops){
  if(stops.length===1) return stops[0];
  const seg = 1/(stops.length-1);
  const i = Math.min(stops.length-2, Math.floor(t/seg));
  const localT = (t - i*seg)/seg;
  const c = rgbToHex(lerpRgb(hexToRgb(stops[i]), hexToRgb(stops[i+1]), clamp(localT,0,1)));
  return c;
}

/* build array of [char, hex] for text */
function colorizeText(text, stops, mode, charsPerColor, trimSpaces){
  const chars = splitChars(text);
  const indices = trimSpaces ? chars.map((c,idx)=>c.trim()===''?null:idx).filter(i=>i!==null) : chars.map((_,i)=>i);
  const count = indices.length || 1;

  // mapping t for each visible char
  const tmap = new Map();
  if(mode==='map'){
    // chunked per color (like "characters per color")
    const per=charsPerColor;
    indices.forEach((idx,k)=>{
      const colorIndex = Math.floor(k/per);
      const maxColorIndex = Math.max(0, count-1)/per; // approximate spread
      const t = clamp((colorIndex)/Math.max(1,(stops.length-1)*(count/per)), 0, 1);
      tmap.set(idx, t);
    });
  }else{
    // even disperse across whole string
    indices.forEach((idx,k)=>{
      const t = (count===1)?0:(k/(count-1));
      tmap.set(idx, t);
    });
  }

  const result = chars.map((ch,i)=>{
    const t = tmap.has(i) ? tmap.get(i) : null;
    const hex = t===null ? null : gradientAt(t, stops);
    return {ch, hex};
  });
  return result;
}

/* formatters */
function maybeLower(h,lower){ return lower ? h.toLowerCase() : h; }
function withFlags(text, flags, open=true){
  if(!open) return text;
  let pre=''; if(flags.bold) pre+='&l';
  if(flags.italic) pre+='&o';
  if(flags.under) pre+='&n';
  if(flags.strike) pre+='&m';
  if(flags.obf) pre+='&k';
  return pre + text;
}
function fmtMini(colored, state){
  // <gradient:#A:#B:...>TEXT</gradient> + —Ñ–ª–∞–≥–∏ <> –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—Å—Ç–∞
  const hexes = state.colors.map(h=>maybeLower(h,state.lower)).join(':');
  const inner = withFlags(state.text, state.flags, true).replaceAll('<','&lt;').replaceAll('>','&gt;');
  return `<gradient:${hexes}>${inner}</gradient>`;
}
function fmtJSON(colored, state){
  // –ø—Ä–æ—Å—Ç–æ–π vanilla JSON (tellraw): –º–∞—Å—Å–∏–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ [{text, color, bold, ...}]
  const arr = [];
  if(state.prefix) arr.push({text:state.prefix});
  colored.forEach(({ch,hex})=>{
    if(hex===null){ arr.push({text:ch}); return; }
    const o = {text:ch, color: maybeLower(hex,state.lower).replace('#','')};
    if(state.flags.bold) o.bold=true;
    if(state.flags.italic) o.italic=true;
    if(state.flags.under) o.underlined=true;
    if(state.flags.strike) o.strikethrough=true;
    if(state.flags.obf) o.obfuscated=true;
    if(state.shadow) o.shadow=true; // –Ω–µ –≤–∞–Ω–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ, –Ω–æ –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ ¬´hint¬ª
    arr.push(o);
  });
  if(state.suffix) arr.push({text:state.suffix});
  return JSON.stringify(arr);
}
function toSec(hex){ const h=maybeLower(hex,true); return '¬ßx' + h.slice(1).split('').map(n=>'¬ß'+n).join(''); }
function toAmp(hex){ const h=maybeLower(hex,true); return '&x' + h.slice(1).split('').map(n=>'&'+n).join(''); }
function toSharp(hex){ return `<${maybeLower(hex,state.lower)}>`; }

function fmtPerChar(colored, builder, state){
  let out = state.prefix || '';
  colored.forEach(({ch,hex})=>{
    if(hex===null){ out+=ch; return; }
    out += builder(maybeLower(hex,state.lower));
    out += ch;
  });
  out += state.suffix || '';
  // –¥–æ–±–∞–≤–∏–º —Ñ–æ—Ä–º–∞—Ç-—Ñ–ª–∞–≥–∏ –∫–∞–∫ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ &l –∏ —Ç.–ø. (–∫–∞–∫ –≤ Birdflop)
  if(state.flags.bold||state.flags.italic||state.flags.under||state.flags.strike||state.flags.obf){
    const prefixFlags = withFlags('', state.flags, true);
    out = prefixFlags + out;
  }
  return out;
}

/* decode experimental (tries to guess stops) ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–æ */
function decodeExperimental(str){
  const hexes = (str.match(/#?[0-9a-fA-F]{6}/g)||[]).map(h=>h.startsWith('#')?h:('#'+h));
  if(hexes.length>=2){ state.colors = [hexes[0], hexes[Math.floor(hexes.length/2)], hexes[hexes.length-1]]; rebuildColors(); update(); alert('–ü–æ–ø—Ä–æ–±–æ–≤–∞–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 3 —Å—Ç–æ–ø–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞.'); }
  else alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å HEX.');
}

/* ====== preview render (CSS gradient on text) ====== */
function renderPreview(colored){
  const el = $('#preview');
  el.textContent = state.text || ' ';
  el.style.fontSize = state.size+'px';
  // —Å–æ–∑–¥–∞—ë–º –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–ª–µ–≤–∞->–Ω–∞–ø—Ä–∞–≤–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–∏–º–≤–æ–ª–æ–≤
  const indices = colored.filter(x=>x.hex!==null);
  if(indices.length===0){ el.style.background='none'; el.style.webkitBackgroundClip='initial'; el.style.color= 'var(--text)'; return; }
  const parts = indices.map((obj,i)=>`${obj.hex} ${(i/(indices.length-1))*100}%`);
  el.style.background = `linear-gradient(90deg, ${parts.join(',')})`;
  el.style.webkitBackgroundClip='text';
  el.style.backgroundClip='text';
  el.style.color='transparent';
}

/* ====== export dispatcher ====== */
function renderOutput(colored){
  const out = $('#out');
  const fmt = state.fmt;
  if(fmt==='mini'){ out.textContent = fmtMini(colored, state); return; }
  if(fmt==='json'){ out.textContent = fmtJSON(colored, state); return; }
  if(fmt==='sec'){ out.textContent = fmtPerChar(colored, toSec, state); return; }
  if(fmt==='amp'){ out.textContent = fmtPerChar(colored, toAmp, state); return; }
  if(fmt==='sharp'){ out.textContent = fmtPerChar(colored, toSharp, state); return; }
  if(fmt==='custom'){
    try{
      const obj = state.customTpl ? JSON.parse(state.customTpl) : {"color":"[COLOR=#$1$2$3$4$5$6]$c[/COLOR]","bold":"[B]$t[/B]","italic":"[I]$t[/I]"};
      // —Å—Ç—Ä–æ–∏–º –ø–æ —Å–∏–º–≤–æ–ª–∞–º
      let outStr = state.prefix || '';
      colored.forEach(({ch,hex})=>{
        if(hex===null){ outStr+=ch; return; }
        const H = maybeLower(hex,state.lower).slice(1); // rrggbb
        let seg = (obj.color||"$c").replaceAll('$c','').replaceAll('$1',H[0]).replaceAll('$2',H[1]).replaceAll('$3',H[2]).replaceAll('$4',H[3]).replaceAll('$5',H[4]).replaceAll('$6',H[5]);
        outStr += seg + ch;
      });
      if(state.flags.bold && obj.bold) outStr = obj.bold.replaceAll('$t', outStr);
      if(state.flags.italic && obj.italic) outStr = obj.italic.replaceAll('$t', outStr);
      if(state.flags.under && obj.underline) outStr = obj.underline.replaceAll('$t', outStr);
      if(state.flags.strike && obj.strikethrough) outStr = obj.strikethrough.replaceAll('$t', outStr);
      if(state.flags.obf && obj.obfuscate) outStr = obj.obfuscate.replaceAll('$t', outStr);
      out.textContent = outStr + (state.suffix||'');
    }catch(e){
      out.textContent = '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ custom JSON';
    }
  }
}

/* ====== presets (save/load/url) ====== */
$('#savePreset').onclick=()=>{
  const name = prompt('–ò–º—è –ø—Ä–µ—Å–µ—Ç–∞:'); if(!name) return;
  const payload = JSON.stringify(state);
  localStorage.setItem('rgb_preset_'+name, payload);
  alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ.');
};
$('#loadPreset').onclick=()=>{
  const keys = Object.keys(localStorage).filter(k=>k.startsWith('rgb_preset_'));
  if(keys.length===0){ alert('–ù–µ—Ç –ø—Ä–µ—Å–µ—Ç–æ–≤'); return; }
  const name = prompt('–î–æ—Å—Ç—É–ø–Ω—ã–µ:\n'+keys.map(k=>k.replace('rgb_preset_','')).join(', ')+'\n\n–ò–º—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:');
  if(!name) return;
  const data = localStorage.getItem('rgb_preset_'+name);
  if(!data){ alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ'); return; }
  Object.assign(state, JSON.parse(data));
  rebuildColors(); hydrateUI(); update();
};
$('#copyUrl').onclick=()=>{
  const data = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
  const url = location.origin + location.pathname + '#cfg=' + data;
  navigator.clipboard.writeText(url).then(()=>alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'));
};
$('#decode').onclick=()=>{
  const s = prompt('–í—Å—Ç–∞–≤—å RGB-—Ç–µ–∫—Å—Ç / HEX-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:');
  if(!s) return;
  decodeExperimental(s);
};
/* boot from URL if present */
(function bootFromUrl(){
  const m = location.hash.match(/#cfg=([^&]+)/);
  if(m){
    try{
      const data = JSON.parse(decodeURIComponent(escape(atob(m[1]))));
      Object.assign(state, data);
    }catch(_){}
  }
})();

/* ====== hydrate UI (flags etc) ====== */
function hydrateUI(){
  $('#text').value=state.text;
  $('#mode').value=state.mode;
  $('#charsPerColor').value=state.charsPerColor;
  $('#lower').value=state.lower?'yes':'no';
  $('#trim').value=state.trim?'yes':'no';
  $('#shadow').value=state.shadow?'yes':'no';
  $('#size').value=state.size;
  $('#bold').checked=state.flags.bold;
  $('#italic').checked=state.flags.italic;
  $('#under').checked=state.flags.under;
  $('#strike').checked=state.flags.strike;
  $('#obf').checked=state.flags.obf;
  $('#prefix').value=state.prefix;
  $('#suffix').value=state.suffix;
  $('#customTpl').value=state.customTpl||'';
}

/* ====== main update ====== */
function update(){
  // sanitize colors
  state.colors = state.colors.map(h=>('#'+h.replace('#','')).slice(0,7).padEnd(7,'0'));
  // build char colors
  const colored = colorizeText(state.text, state.colors, state.mode, state.charsPerColor, state.trim);
  renderPreview(colored);
  renderOutput(colored);
}
rebuildColors(); hydrateUI(); update();

/* copy out */
$('#copy').onclick=()=>navigator.clipboard.writeText($('#out').textContent).then(()=>alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'));
</script>
</body>
</html>
